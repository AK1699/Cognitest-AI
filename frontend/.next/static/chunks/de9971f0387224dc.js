(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,58805,e=>{"use strict";var r=e.i(43476),s=e.i(71645),a=e.i(75918),t=e.i(75254);let l=(0,t.default)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var i=e.i(84614),n=e.i(61911),d=e.i(55436);let o=(0,t.default)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var c=e.i(27612),m=e.i(98919),x=e.i(7233),g=e.i(18566),p=e.i(46696),u=e.i(67665);let h={owner:{displayName:"Owner",type:"Super Administrator",description:"Has full control ‚Äî can manage billing, delete the organization, assign roles, and configure SSO"},admin:{displayName:"Admin",type:"Administration",description:"Manages organization settings, users, integrations, and platform operations"},qa_manager:{displayName:"QA Manager",type:"Quality Assurance",description:"Manages QA teams, assigns testers, oversees test execution, and reviews results"},qa_lead:{displayName:"QA Lead",type:"Quality Assurance",description:"Leads QA engineers, approves test cases, and validates AI-generated fixes"},qa_engineer:{displayName:"QA Engineer",type:"Quality Assurance",description:"Creates, executes, and maintains automated and manual tests"},product_owner:{displayName:"Product Owner",type:"Stakeholder",description:"Represents business interests, reviews reports and KPIs, ensures testing aligns with product goals"},viewer:{displayName:"Viewer",type:"Read Only",description:"Has view-only access to dashboards, reports, and analytics"}};var y=e.i(88675),b=e.i(44002);async function f(e){return(await b.default.get("/api/v1/roles/",{params:{organisation_id:e}})).data}async function j(e,r){return(await b.default.get("/api/v1/roles/assignments/users",{params:{user_id:e,project_id:r}})).data.assignments||[]}async function N(e,r){return(await b.default.get("/api/v1/roles/assignments/groups",{params:{group_id:e,project_id:r}})).data.assignments||[]}async function v(e,r,s){return(await b.default.post("/api/v1/roles/assignments/users",{user_id:e,role_id:r,project_id:s})).data}async function w(e,r,s){return(await b.default.post("/api/v1/roles/assignments/groups",{group_id:e,role_id:r,project_id:s})).data}async function k(e){await b.default.delete(`/api/v1/roles/assignments/users/${e}`)}async function _(e){await b.default.delete(`/api/v1/roles/assignments/groups/${e}`)}async function C(e,r,s,a,t){return(await b.default.post("/api/v1/roles/",{organisation_id:e,name:r,role_type:s,description:a,permissions:t||[]})).data}async function S(e){await b.default.delete(`/api/v1/roles/${e}`)}async function A(){return(await b.default.get("/api/v1/roles/permissions")).data.permissions||[]}async function P(e){return(await b.default.get(`/api/v1/organisations/${e}/users`)).data}var $=e.i(37727);function R({isOpen:e,onClose:t,organisationId:l,projectId:i,entityType:n,entityId:d,entityName:o,availableProjects:x=[],onRoleAssigned:g,onModalOpen:u}){let y,b,C,S,[A,P]=(0,s.useState)(!1),[R,T]=(0,s.useState)([]),[E,z]=(0,s.useState)([]),[I,F]=(0,s.useState)(i||""),[L,O]=(0,s.useState)(i||""),[U,M]=(0,s.useState)(""),[D,B]=(0,s.useState)(!1);(0,s.useEffect)(()=>{e&&(u&&u(),Q(),q())},[e,l]),(0,s.useEffect)(()=>{e&&L&&H()},[L,d]);let q=async()=>{try{if("user"===n&&x.length>0){let e=[];for(let r of x)try{let s=await j(d,r.id);e=[...e,...s]}catch(e){}z(e)}}catch(e){console.error("Error fetching all user roles:",e)}},Q=async()=>{P(!0);try{let e=await f(l);T(e.roles)}catch(e){console.error("Error fetching roles:",e),p.toast.error(e.message||"Failed to load roles")}finally{P(!1)}},H=async()=>{if(L)try{if("user"===n){let e=await j(d,L);z(e)}else{let e=await N(d,L);z(e)}}catch(e){console.error("Error fetching current roles:",e),p.toast.error(e.message||"Failed to load current roles")}},J=async()=>{let e=R.find(e=>e.id===U),r=e?.role_type==="administrator";if(U&&(r||I))try{let e=I,s=new Set(E.map(e=>e.project_id));if(r&&!e&&x.length>0){let r=x.find(e=>!s.has(e.id));r?e=r.id:(e=x[0].id,p.toast.warning("User already has roles in all projects. Attempting to assign as admin role (may need to remove existing role first)."))}if(!r&&I&&s.has(I)){let r=x.find(e=>!s.has(e.id));if(!r)return void p.toast.error("User already has a role on all projects. Please remove an existing role first, or assign an admin role for organization-wide access.");e=r.id,p.toast.info(`User already has a role on "${x.find(e=>e.id===I)?.name||"selected project"}". Assigning to "${r.name}" instead.`)}if(!e)return void p.toast.error("Please create a project first before assigning roles");"user"===n?await v(d,U,e):await w(d,U,e),p.toast.success("Role assigned successfully"),r&&p.toast.success("‚úÖ Admin user now has automatic access to all projects in this organization"),M(""),F(""),B(!1),L===e&&await H(),g&&await g()}catch(e){p.toast.error(e.response?.data?.detail||e.message||"Failed to assign role")}},K=async e=>{if(confirm("Are you sure you want to remove this role assignment?"))try{"user"===n?await k(e):await _(e),p.toast.success("Role removed successfully"),await q(),L&&await H()}catch(e){p.toast.error(e.message||"Failed to remove role")}},V=e=>{switch(e){case"administrator":return"bg-red-100 text-red-800 border-red-200";case"project_manager":return"bg-purple-100 text-purple-800 border-purple-200";case"developer":return"bg-blue-100 text-blue-800 border-blue-200";case"tester":return"bg-green-100 text-green-800 border-green-200";case"viewer":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-cyan-100 text-cyan-800 border-cyan-200"}};return e?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(m.Shield,{className:"w-6 h-6 text-primary"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Manage Roles - ",o]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Assign and manage roles for this ",n]})]})]}),(0,r.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,r.jsx)($.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:A?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"text-gray-500",children:"Loading roles..."})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Assign Role"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Role"}),(0,r.jsxs)("select",{value:U,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"",children:"Choose a role..."}),R.map(e=>(0,r.jsx)("option",{value:e.id,children:function(e){let r,s=h[e.toLowerCase()];return s?`${s.displayName} (${s.type})`:(r=h[e.toLowerCase()])?r.displayName:e.replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}(e.role_type)},e.id))]})]}),U&&(()=>{let e=R.find(e=>e.id===U);if(e?.role_type==="administrator")return(0,r.jsx)("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(m.Shield,{className:"w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-semibold text-green-800 dark:text-green-200 mb-1",children:"Admin Role - No Project Selection Needed"}),(0,r.jsx)("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Admin users automatically have full access to all projects in this organization."})]})]})});let s=new Set(E.map(e=>e.project_id));return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Project to Assign To"}),x.length>0?(0,r.jsxs)("select",{value:I,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"",children:"Select a project..."}),x.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name,s.has(e.id)?" (already assigned)":""]},e.id))]}):(0,r.jsx)("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,r.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"‚ö†Ô∏è No projects available. Please create a project first before assigning roles."})})]}),s.size>0&&(0,r.jsxs)("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs font-semibold text-amber-800 dark:text-amber-200 mb-2",children:"‚ÑπÔ∏è User already has roles on:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:x.filter(e=>s.has(e.id)).map(e=>(0,r.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-amber-200 text-amber-900 dark:bg-amber-800 dark:text-amber-100 rounded",children:e.name},e.id))}),(0,r.jsx)("p",{className:"text-xs text-amber-700 dark:text-amber-300 mt-2",children:"System will automatically use a different project if you select one with an existing role."})]})]})})(),U&&(0,r.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(y=R.find(e=>e.id===U))?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)(m.Shield,{className:"w-5 h-5 text-blue-600"}),(0,r.jsx)("span",{className:"font-semibold text-blue-900 dark:text-blue-100",children:y.name}),(0,r.jsx)("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full border ${V(y.role_type)}`,children:y.role_type.replace("_"," ")})]}),y.description&&(0,r.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-200",children:y.description})]}):null}),(b=R.find(e=>e.id===U),C=b?.role_type==="administrator",S=U&&(C||I),(0,r.jsx)(a.Button,{onClick:J,disabled:!S,className:"w-full",children:"Assign Role"}))]})]}),(0,r.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Current Roles"}),E.length>0?(0,r.jsx)("div",{className:"space-y-3 mb-4",children:E.map(e=>{let s=e.role?.name||e.role_name||"Unknown Role",a=e.role?.role_type||e.role_type||"system",t=e.project_id,l=x.find(e=>e.id===t)?.name||"Unknown Project";return(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:s}),(0,r.jsx)("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full border ${V(a)}`,children:a.replace("_"," ")})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Project: ",l]})]}),(0,r.jsx)("button",{onClick:()=>K(e.id),className:"ml-4 p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove role",children:(0,r.jsx)(c.Trash2,{size:16})})]},e.id)})}):(0,r.jsxs)("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600",children:[(0,r.jsx)(m.Shield,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"No roles assigned yet"})]}),x.length>0&&(0,r.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"View roles by project (optional)"}),(0,r.jsxs)("select",{value:L,onChange:e=>{O(e.target.value),e.target.value&&H()},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"",children:"All projects"}),x.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),L&&0===E.length?(0,r.jsxs)("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600",children:[(0,r.jsx)(m.Shield,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No roles assigned yet for this project"})]}):(0,r.jsx)("div",{className:"space-y-3",children:E.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(m.Shield,{className:"w-5 h-5 text-gray-400"}),(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:e.role?.name||e.role_name}),(0,r.jsx)("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full border ${V(e.role?.role_type||e.role_type)}`,children:(e.role?.role_type||e.role_type).replace("_"," ")})]})})]}),(0,r.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:()=>K(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:(0,r.jsx)(c.Trash2,{className:"w-4 h-4"})})]},e.id))})]})]})}),(0,r.jsx)("div",{className:"flex items-center justify-end gap-2 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:(0,r.jsx)(a.Button,{variant:"outline",onClick:t,children:"Close"})})]})}):null}var T=e.i(21332),E=e.i(31278);let z={"User Management":["user_read_access","user_write_access","user_delete_access"],"Role Management":["role_read_access","role_write_access","role_delete_access"],"Project Management":["project_read_access","project_write_access","project_delete_access"],Settings:["settings_read_access","settings_write_access"],Organization:["organization_manage_access"],"Test Case Management":["test_case_read_access","test_case_write_access","test_case_delete_access","test_case_execute_access"],"Security Testing":["security_test_read_access","security_test_write_access","security_test_delete_access","security_test_execute_access"],"API Testing":["api_test_read_access","api_test_write_access","api_test_delete_access","api_test_execute_access"],"Automation Hub":["automation_read_access","automation_write_access","automation_delete_access","automation_execute_access"]};function I({organisationId:e,isAdmin:a=!1}){let[t,l]=(0,s.useState)([]),[i,n]=(0,s.useState)([]),[d,o]=(0,s.useState)(!0),[c,m]=(0,s.useState)({}),[x,g]=(0,s.useState)(z);(0,s.useEffect)(()=>{p()},[e]);let p=async()=>{o(!0);try{let r=(await b.default.get("/api/v1/roles/",{params:{organisation_id:e}})).data.roles||[];console.log("üéØ Roles from API:",r.map(e=>({id:e.id,name:e.name,role_type:e.role_type,permissions_from_api:e.permissions?.length||0,permission_count:e.permission_count}))),l(r);let s=[];try{let{permission_groups:r,all_permissions:a,enabled_modules:t}=(await b.default.get(`/api/v1/roles/dynamic/${e}`)).data;r&&g(r),t&&setEnabledModules(t),s=a||[],n(s)}catch(e){console.warn("Could not fetch dynamic permissions, using static permissions:",e),s=(await b.default.get("/api/v1/roles/permissions")).data.permissions||[],n(s)}let a={},t={};s.forEach(e=>{t[e.name]=e.id}),console.log("üîç Permission name to ID mapping:",Object.keys(t).slice(0,5)),console.log("üìã Total permissions found:",s.length),r.forEach(e=>{let r=[];console.log(`üîç Processing role "${e.name}" (${e.role_type}):`,{hasPermissions:!!e.permissions,permissionCount:e.permissions?.length||0,permissionIds:e.permissions?.map(e=>e.id)||[]}),e.permissions&&e.permissions.length>0?(r=e.permissions.map(e=>e.id),console.log(`‚úÖ Role "${e.name}" (${e.role_type}): ${r.length} permissions from API`),console.log(`   Permission IDs: ${r.slice(0,3).join(", ")}...`)):console.log(`‚ö†Ô∏è Role "${e.name}" (${e.role_type}) has NO permissions assigned in database`),a[e.id]=r}),console.log("üìù Detailed permission mapping:"),Object.entries(a).forEach(([e,a])=>{let t=r.find(r=>r.id===e);console.log(`  ${t?.name}: [${a.map(e=>{let r=s.find(r=>r.id===e);return r?.name||e}).join(", ")}]`)}),console.log("üìä Final permission map:",Object.entries(a).map(([e,r])=>({roleId:e.slice(0,8),count:r.length,sampleIds:r.slice(0,2)}))),m(a),setOriginalRolePermissions(JSON.parse(JSON.stringify(a)))}catch(e){console.error("Failed to fetch data:",e),toast.error("Failed to load roles and permissions")}finally{o(!1)}};return d?(0,r.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,r.jsx)(E.Loader2,{className:"w-6 h-6 animate-spin text-primary"}),(0,r.jsx)("span",{className:"ml-2",children:"Loading permission matrix..."})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Role Permissions Matrix"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"View current role permissions (read-only)"})]}),(0,r.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-800",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("th",{className:"px-3 py-3 text-left font-semibold text-gray-900 dark:text-white sticky left-0 bg-gray-50 dark:bg-gray-900 z-10",style:{width:"192px"},children:"Permission"}),t.map(e=>(0,r.jsx)("th",{className:"px-2 py-3 text-center font-semibold text-gray-900 dark:text-white whitespace-nowrap align-middle",style:{width:"120px"},children:(0,r.jsx)("div",{className:"truncate text-xs",title:e.name,children:e.name})},e.id))]})}),(0,r.jsx)("tbody",{children:Object.entries(x).map(([e,a])=>(0,r.jsxs)(s.Fragment,{children:[(0,r.jsx)("tr",{className:"bg-blue-50 dark:bg-blue-900/20 border-b border-gray-200 dark:border-gray-700",children:(0,r.jsx)("td",{colSpan:t.length+1,className:"px-3 py-2 text-sm font-bold text-blue-900 dark:text-blue-200 sticky left-0 bg-blue-50 dark:bg-blue-900/20 z-10",children:e})}),a.map((s,a)=>{let l=i.find(e=>e.name===s);return l?(0,r.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,r.jsx)("td",{className:"px-3 py-3 text-gray-900 dark:text-white sticky left-0 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/50 z-10 align-middle",style:{width:"192px"},children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-xs truncate",title:l.name,children:l.name}),(0,r.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 hidden sm:block truncate",title:l.description||`${l.action} ${l.resource}`,children:l.description||`${l.action} ${l.resource}`})]})}),t.map(e=>{let s=(c[e.id]||[]).includes(l.id);return(0,r.jsx)("td",{className:"px-2 py-3 text-center align-middle",style:{width:"120px"},children:(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("input",{type:"checkbox",checked:!0===s,onChange:()=>{},className:"w-4 h-4 accent-primary",disabled:!0,title:"Permission matrix is read-only","data-role":e.id,"data-perm":l.id})})},`${e.id}-${l.id}`)})]},`${e}-${s}-${a}`):null})]},e))})]})})}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:t.map(e=>(0,r.jsxs)("div",{className:"p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800",children:[(0,r.jsx)("div",{className:"text-xs font-semibold text-gray-900 dark:text-white mb-1 truncate",title:e.name,children:e.name}),(0,r.jsx)("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:(c[e.id]||[]).length}),(0,r.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"assigned"})]},e.id))})]})}var F=e.i(68695);function L(){let e,t,j=(0,g.useParams)().uuid,{user:N}=(0,F.useAuth)(),[v,w]=(0,s.useState)("users"),[k,_]=(0,s.useState)(null),[$,E]=(0,s.useState)([]),[z,L]=(0,s.useState)([]),[O,U]=(0,s.useState)([]),[M,D]=(0,s.useState)([]),[B,q]=(0,s.useState)(!0),[Q,H]=(0,s.useState)(""),[J,K]=(0,s.useState)([]),[V,X]=(0,s.useState)({}),[G,W]=(0,s.useState)(!1),[Z,Y]=(0,s.useState)(!1),[ee,er]=(0,s.useState)(!1),[es,ea]=(0,s.useState)(!1),[et,el]=(0,s.useState)(!1),[ei,en]=(0,s.useState)("list"),[ed,eo]=(0,s.useState)(!1),[ec,em]=(0,s.useState)(null),[ex,eg]=(0,s.useState)(null),[ep,eu]=(0,s.useState)(null),[eh,ey]=(0,s.useState)(null),[eb,ef]=(0,s.useState)(null),[ej,eN]=(0,s.useState)(""),[ev,ew]=(0,s.useState)(!1),[ek,e_]=(0,s.useState)({email:"",username:"",password:"",full_name:""}),[eC,eS]=(0,s.useState)({name:"",roleType:"",description:"",selectedPermissions:[]});(0,s.useEffect)(()=>{(async()=>{try{let e=(await b.default.get("/api/v1/projects/",{params:{organisation_id:j}})).data;K(e),await Promise.all([eP(e),eE()])}catch(e){console.error("Error loading data:",e),p.toast.error("Failed to load data")}})()},[j,v]);let eA=async()=>{await eP(J)},eP=async e=>{q(!0);try{let r=await b.default.get(`/api/v1/organisations/${j}`);_(r.data);let s=N?.is_superuser||N?.id===r.data.owner_id;W(s);let a=await P(j);E(a);let t=await f(j);L(t.roles),await e$(a,e),a.length>0&&eR(a,e)}catch(e){console.error("Error fetching data:",e),p.toast.error(e.message||"Failed to load data")}finally{q(!1)}},e$=async(e,r=J)=>{try{let e=[];for(let s of r)try{let r=await b.default.get("/api/v1/roles/assignments/users",{params:{project_id:s.id}});r.data.assignments&&(e=[...e,...r.data.assignments])}catch(e){}D(e)}catch(e){console.error("Error fetching user roles:",e)}},eR=async(e,r=J)=>{try{let s={};for(let a of e){let e=[];for(let s of r)try{(await b.default.get(`/api/v1/projects/${s.id}/members`)).data.some(e=>e.id===a.id)&&e.push(s)}catch(e){}s[a.id]=e}X(s)}catch(e){console.error("Error fetching user projects:",e)}},eT=async e=>{try{let r=[];for(let s of J)try{(await b.default.get(`/api/v1/projects/${s.id}/members`)).data.some(r=>r.id===e)&&r.push(s)}catch(e){}X(s=>({...s,[e]:r}))}catch(e){console.error("Failed to fetch user projects:",e)}},eE=async()=>{try{let e=await A();U(e)}catch(e){console.error("Error fetching permissions:",e)}},ez=async()=>{if(!ek.email)return void p.toast.error("Email address is required");try{await (0,T.createInvitation)({email:ek.email,full_name:ek.full_name||void 0,organisation_id:j,expiry_days:7}),p.toast.success(`Invitation sent to ${ek.email}`),Y(!1),e_({email:"",username:"",password:"",full_name:""}),eA()}catch(e){console.error("Failed to send invitation:",e),p.toast.error(e.response?.data?.detail||"Failed to send invitation")}},eI=async e=>{if(eh)try{await b.default.post(`/api/v1/projects/${e}/members`,null,{params:{user_id:eh.id}}),p.toast.success(`${eh.username} assigned to project`),await eT(eh.id)}catch(e){console.error("Failed to assign user:",e),p.toast.error(e.response?.data?.detail||"Failed to assign user")}},eF=async e=>{if(eh&&confirm(`Remove ${eh.username} from this project?`))try{await b.default.delete(`/api/v1/projects/${e}/members/${eh.id}`),p.toast.success("User removed from project"),await eT(eh.id)}catch(e){console.error("Failed to remove user:",e),p.toast.error(e.response?.data?.detail||"Failed to remove user")}},eL=async()=>{if(!eC.name||!eC.roleType)return void p.toast.error("Please fill in all required fields");try{await C(j,eC.name,eC.roleType,eC.description,eC.selectedPermissions),p.toast.success("Role created successfully"),el(!1),eS({name:"",roleType:"",description:"",selectedPermissions:[]}),eA()}catch(e){console.error("Failed to create role:",e),p.toast.error(e.response?.data?.detail||"Failed to create role")}},eO=async e=>{e.is_system_role?p.toast.error("Cannot delete system roles"):(em(e),eo(!0))},eU=async()=>{if(ec){eg(ec.id);try{await S(ec.id),p.toast.success(`Role "${ec.name}" deleted successfully`),eo(!1),em(null),eA()}catch(e){console.error("Failed to delete role:",e),p.toast.error(e.response?.data?.detail||"Failed to delete role")}finally{eg(null)}}},eM=$.filter(e=>e.email.toLowerCase().includes(Q.toLowerCase())||e.username.toLowerCase().includes(Q.toLowerCase())||e.full_name&&e.full_name.toLowerCase().includes(Q.toLowerCase())),eD=z.filter(e=>e.name.toLowerCase().includes(Q.toLowerCase())||e.role_type.toLowerCase().includes(Q.toLowerCase())||e.description&&e.description.toLowerCase().includes(Q.toLowerCase())).sort((e,r)=>e.name.localeCompare(r.name));return B?(0,r.jsxs)("div",{className:"flex min-h-screen",children:[(0,r.jsx)(y.Sidebar,{organisationId:j}),(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center bg-white",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("div",{className:"text-gray-500",children:"Loading..."})})})]}):(0,r.jsxs)("div",{className:"flex min-h-screen bg-white",children:[(0,r.jsx)(y.Sidebar,{organisationId:j}),(0,r.jsxs)("div",{className:"flex-1 p-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-primary rounded-2xl flex items-center justify-center flex-shrink-0",children:(0,r.jsx)(n.Users,{className:"w-8 h-8 text-white"})}),(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Users & Teams"})]}),(0,r.jsx)("p",{className:"text-lg text-gray-600 mb-8 mt-4",children:"Manage user access, teams, and role assignments"}),(0,r.jsx)("div",{className:"flex items-center justify-end mb-8",children:(0,r.jsxs)("div",{className:"flex gap-2",children:["users"===v&&(0,r.jsxs)(a.Button,{onClick:()=>Y(!0),children:[(0,r.jsx)(l,{className:"mr-2 h-4 w-4"}),"Invite User"]}),"roles"===v&&(0,r.jsxs)(a.Button,{onClick:()=>el(!0),children:[(0,r.jsx)(m.Shield,{className:"mr-2 h-4 w-4"}),"Create Role"]})]})}),(0,r.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,r.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,r.jsxs)("button",{onClick:()=>w("users"),className:`${"users"===v?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2`,children:[(0,r.jsx)(i.User,{className:"w-4 h-4"}),"Users (",$.length,")"]}),(0,r.jsxs)("button",{onClick:()=>w("roles"),className:`${"roles"===v?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2`,children:[(0,r.jsx)(m.Shield,{className:"w-4 h-4"}),"Roles (",z.length,")"]})]})}),(0,r.jsx)("div",{className:"mb-6 flex gap-3",children:(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(d.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"text",placeholder:`Search ${v}...`,value:Q,onChange:e=>H(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]})}),"users"===v&&(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"User"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Role"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Projects"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Created"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-center",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:0===eM.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500",children:"No users found. Invite users to get started."})}):eM.map(e=>(0,r.jsxs)("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"h-10 w-10 flex-shrink-0",children:(0,r.jsx)("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-teal-500 to-cyan-600 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-sm font-semibold text-white",children:e.username.substring(0,2).toUpperCase()})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.full_name||e.username}),(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(()=>{let s=M.filter(r=>r.user_id===e.id);if(0===s.length)return(0,r.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No roles"});let a=Array.from(new Map(s.map(e=>[e.role?.name||e.role_name||"Unknown Role",e])).values());return(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:a.map(e=>(0,r.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:e.role?.name||e.role_name||"Unknown Role"},e.id))})})()}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"space-y-1",children:[M.some(r=>r.user_id===e.id&&(r.role?.name==="Admin"||"Admin"===r.role_name))?(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[(0,r.jsx)(m.Shield,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,r.jsx)("span",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"All projects (auto)"})]}):(V[e.id]||[]).length>0?(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:(V[e.id]||[]).map(e=>(0,r.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:e.name},e.id))}):(0,r.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No projects"}),(0,r.jsxs)("button",{onClick:()=>{ey(e),er(!0)},className:"text-xs text-primary hover:underline flex items-center gap-1 mt-1",children:[(0,r.jsx)(x.Plus,{className:"w-3 h-3"}),"Manage Projects"]})]})}),(0,r.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:(0,u.formatDateHumanReadable)(e.created_at)}),(0,r.jsx)("td",{className:"px-6 py-4 flex justify-center items-center",children:(0,r.jsxs)("button",{onClick:()=>{ef({type:"user",id:e.id,name:e.full_name||e.username}),ea(!0)},className:"flex items-center gap-1 px-3 py-2 rounded-lg text-blue-600 bg-blue-50 hover:bg-blue-100 dark:text-blue-400 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 transition-colors",children:[(0,r.jsx)(o,{className:"w-4 h-4"}),"Edit Roles"]})})]},e.id))})]})})}),"roles"===v&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-6 flex gap-4 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("button",{onClick:()=>en("list"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors ${"list"===ei?"border-primary text-primary":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:"üìã Roles List"}),(0,r.jsx)("button",{onClick:()=>en("matrix"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors ${"matrix"===ei?"border-primary text-primary":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:"üîê Permission Matrix"})]}),"list"===ei&&(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Role Name"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Type"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Description"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Status"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"System Role"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Created"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:0===eD.length?(0,r.jsx)("tr",{children:(0,r.jsxs)("td",{colSpan:7,className:"px-6 py-8 text-center text-gray-500",children:["No roles found. ",0===z.length?"Initialize default roles or create a custom role to get started.":"Try adjusting your search."]})}):eD.map(e=>{let s;return(0,r.jsxs)("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:(s=h[e.role_type.toLowerCase()])?s.type:"Unknown"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate",children:e.description||"-"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:e.is_active?"Active":"Inactive"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.is_system_role?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:e.is_system_role?"System":"Custom"})}),(0,r.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:(0,u.formatDateHumanReadable)(e.created_at)}),(0,r.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,r.jsxs)("button",{onClick:()=>eO(e),disabled:e.is_system_role||ex===e.id,className:"inline-flex items-center gap-2 text-red-600 hover:text-red-800 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors",title:e.is_system_role?"Cannot delete system roles":"Delete role",children:[(0,r.jsx)(c.Trash2,{size:16}),ex===e.id?"Deleting...":"Delete"]})})]},e.id)})})]})})}),"matrix"===ei&&(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-8",children:(0,r.jsx)(I,{organisationId:j,isAdmin:G})})]}),Z&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"üìß Invite User"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"Send an invitation email. The user will receive a welcome email with a link to create their account and join your organization."}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Email Address ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"email",value:ek.email,onChange:e=>e_({...ek,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"user@example.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Full Name (Optional)"}),(0,r.jsx)("input",{type:"text",value:ek.full_name,onChange:e=>e_({...ek,full_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"John Doe"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"This will be pre-filled in the invitation email"})]}),(0,r.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:(0,r.jsxs)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["üí° The invitation will expire in ",(0,r.jsx)("strong",{children:"7 days"}),". The user will choose their username and password when they accept the invitation."]})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,r.jsx)(a.Button,{variant:"outline",onClick:()=>{Y(!1),e_({email:"",username:"",password:"",full_name:""})},children:"Cancel"}),(0,r.jsx)(a.Button,{onClick:ez,disabled:!ek.email,children:"Send Invitation"})]})]})}),et&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Create Custom Role"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"Create a custom role with specific permissions for your organization."}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Role Name ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",value:eC.name,onChange:e=>eS({...eC,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"e.g., QA Lead"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Role Type ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",value:eC.roleType,onChange:e=>eS({...eC,roleType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"e.g., qa_lead (lowercase, underscores)"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Use lowercase letters and underscores only (e.g., qa_lead, senior_qa_engineer)"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),(0,r.jsx)("textarea",{value:eC.description,onChange:e=>eS({...eC,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:3,placeholder:"Describe the responsibilities and access level of this role..."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Permissions (Optional)"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"Select permissions by module. Each module has READ, WRITE, EXECUTE, and MANAGE permission levels."}),(0,r.jsx)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-md p-4 max-h-96 overflow-y-auto",children:0===O.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No permissions available. Run the module permissions initialization script first."}):(0,r.jsx)("div",{className:"space-y-4",children:(e=O.reduce((e,r)=>{let s=r.resource;return e[s]||(e[s]=[]),e[s].push(r),e},{}),t={automation_hub:{name:"Automation Hub",icon:"ü§ñ",color:"blue"},api_testing:{name:"API Testing",icon:"üîå",color:"green"},test_management:{name:"Test Management",icon:"üìã",color:"purple"},security_testing:{name:"Security Testing",icon:"üîí",color:"red"},performance_testing:{name:"Performance Testing",icon:"‚ö°",color:"yellow"},mobile_testing:{name:"Mobile Testing",icon:"üì±",color:"indigo"}},Object.keys(e).sort((e,r)=>{let s=["automation_hub","api_testing","test_management","security_testing","performance_testing","mobile_testing"];return s.indexOf(e)-s.indexOf(r)}).map(s=>{let a=t[s]||{name:s,icon:"üì¶",color:"gray"},l=e[s].sort((e,r)=>{let s=["read","write","execute","manage"];return s.indexOf(e.action)-s.indexOf(r.action)});return(0,r.jsxs)("div",{className:`border rounded-lg p-3 ${{blue:"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800",green:"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800",purple:"bg-purple-50 border-purple-200 dark:bg-purple-900/20 dark:border-purple-800",red:"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800",yellow:"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800",indigo:"bg-indigo-50 border-indigo-200 dark:bg-indigo-900/20 dark:border-indigo-800",gray:"bg-gray-50 border-gray-200 dark:bg-gray-900/20 dark:border-gray-800"}[a.color]}`,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,r.jsx)("span",{className:"text-xl",children:a.icon}),(0,r.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a.name}),(0,r.jsxs)("span",{className:"ml-auto text-xs text-gray-500 dark:text-gray-400",children:[l.filter(e=>eC.selectedPermissions.includes(e.id)).length,"/",l.length," selected"]})]}),(0,r.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,r.jsxs)("label",{className:"flex items-start gap-2 p-2 hover:bg-white/50 dark:hover:bg-gray-800/50 rounded cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:eC.selectedPermissions.includes(e.id),onChange:r=>{r.target.checked?eS({...eC,selectedPermissions:[...eC.selectedPermissions,e.id]}):eS({...eC,selectedPermissions:eC.selectedPermissions.filter(r=>r!==e.id)})},className:"mt-1 h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[(0,r.jsx)("span",{className:"uppercase text-xs px-2 py-0.5 bg-white dark:bg-gray-700 rounded font-semibold",children:e.action}),(0,r.jsx)("span",{className:"truncate text-xs",children:e.name})]}),e.description&&(0,r.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:e.description})]})]},e.id))})]},s)}))})}),eC.selectedPermissions.length>0&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["‚úÖ ",eC.selectedPermissions.length," permission(s) selected across ",new Set(O.filter(e=>eC.selectedPermissions.includes(e.id)).map(e=>e.resource)).size," module(s)"]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,r.jsx)(a.Button,{variant:"outline",onClick:()=>{el(!1),eS({name:"",roleType:"",description:"",selectedPermissions:[]})},children:"Cancel"}),(0,r.jsx)(a.Button,{onClick:eL,disabled:!eC.name||!eC.roleType,children:"Create Role"})]})]})}),ee&&eh&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Manage Projects for ",eh.full_name||eh.username]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Assign or remove this user from projects in your organization"})]})}),(0,r.jsx)("div",{className:"space-y-3",children:0===J.length?(0,r.jsx)("div",{className:"text-center py-12 text-gray-500",children:"No projects available. Create a project first."}):J.map(e=>{let s=(V[eh.id]||[]).some(r=>r.id===e.id);return(0,r.jsxs)("div",{className:`flex items-center justify-between p-4 border rounded-lg transition-colors ${s?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50"}`,children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),s&&(0,r.jsx)("span",{className:"px-2 py-0.5 text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200 rounded-full",children:"Assigned"})]}),e.description&&(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:e.description})]}),(0,r.jsx)("div",{className:"ml-4",children:s?(0,r.jsx)("button",{onClick:()=>eF(e.id),className:"px-4 py-2 text-sm bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/30 transition-colors font-medium",children:"Remove"}):(0,r.jsx)("button",{onClick:()=>eI(e.id),className:"px-4 py-2 text-sm bg-primary text-white rounded-lg hover:opacity-90 transition-opacity font-medium",children:"Assign"})})]},e.id)})}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(V[eh.id]||[]).length," of ",J.length," projects assigned"]}),(0,r.jsx)("button",{onClick:()=>{er(!1),ey(null)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Close"})]})]})}),es&&eb&&(0,r.jsx)(R,{isOpen:es,onClose:()=>{ea(!1),ef(null),eA()},organisationId:j,entityType:eb.type,entityId:eb.id,entityName:eb.name,availableProjects:J,onRoleAssigned:eA,onModalOpen:async()=>{try{let e=await b.default.get("/api/v1/projects/",{params:{organisation_id:j}});K(e.data)}catch(e){console.error("Error refreshing projects:",e)}}}),ed&&ec&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/20",children:(0,r.jsx)(c.Trash2,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),(0,r.jsx)("div",{children:(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Delete Role"})})]}),(0,r.jsxs)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete the role ",(0,r.jsx)("strong",{children:ec.name}),"? This action cannot be undone."]}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,r.jsx)("button",{onClick:()=>{eo(!1),em(null)},disabled:null!==ex,className:"px-4 py-2 text-sm font-medium border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:eU,disabled:null!==ex,className:"px-4 py-2 text-sm font-medium bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:ex===ec.id?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"animate-spin",children:"‚è≥"}),"Deleting..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Trash2,{size:16}),"Delete Role"]})})]})]})})]})]})}e.s(["default",()=>L],58805)}]);