module.exports=[81763,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(91939),e=a.i(70106);let f=(0,e.default)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var g=a.i(46842),h=a.i(60246),i=a.i(87532);let j=(0,e.default)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var k=a.i(81560),l=a.i(3314),m=a.i(15618),n=a.i(50944),o=a.i(23292),p=a.i(30157);let q={owner:{displayName:"Owner",type:"Super Administrator",description:"Has full control ‚Äî can manage billing, delete the organization, assign roles, and configure SSO"},admin:{displayName:"Admin",type:"Administration",description:"Manages organization settings, users, integrations, and platform operations"},qa_manager:{displayName:"QA Manager",type:"Quality Assurance",description:"Manages QA teams, assigns testers, oversees test execution, and reviews results"},qa_lead:{displayName:"QA Lead",type:"Quality Assurance",description:"Leads QA engineers, approves test cases, and validates AI-generated fixes"},qa_engineer:{displayName:"QA Engineer",type:"Quality Assurance",description:"Creates, executes, and maintains automated and manual tests"},product_owner:{displayName:"Product Owner",type:"Stakeholder",description:"Represents business interests, reviews reports and KPIs, ensures testing aligns with product goals"},viewer:{displayName:"Viewer",type:"Read Only",description:"Has view-only access to dashboards, reports, and analytics"}};var r=a.i(9603),s=a.i(84097);async function t(a){return(await s.default.get("/api/v1/roles/",{params:{organisation_id:a}})).data}async function u(a,b){return(await s.default.get("/api/v1/roles/assignments/users",{params:{user_id:a,project_id:b}})).data.assignments||[]}async function v(a,b){return(await s.default.get("/api/v1/roles/assignments/groups",{params:{group_id:a,project_id:b}})).data.assignments||[]}async function w(a,b,c){return(await s.default.post("/api/v1/roles/assignments/users",{user_id:a,role_id:b,project_id:c})).data}async function x(a,b,c){return(await s.default.post("/api/v1/roles/assignments/groups",{group_id:a,role_id:b,project_id:c})).data}async function y(a){await s.default.delete(`/api/v1/roles/assignments/users/${a}`)}async function z(a){await s.default.delete(`/api/v1/roles/assignments/groups/${a}`)}async function A(a,b,c,d,e){return(await s.default.post("/api/v1/roles/",{organisation_id:a,name:b,role_type:c,description:d,permissions:e||[]})).data}async function B(a){await s.default.delete(`/api/v1/roles/${a}`)}async function C(){return(await s.default.get("/api/v1/roles/permissions")).data.permissions||[]}async function D(a){return(await s.default.get(`/api/v1/organisations/${a}/users`)).data}var E=a.i(33508);function F({isOpen:a,onClose:e,organisationId:f,projectId:g,entityType:h,entityId:i,entityName:j,availableProjects:m=[],onRoleAssigned:n,onModalOpen:p}){let r,s,A,B,[C,D]=(0,c.useState)(!1),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)(g||""),[L,M]=(0,c.useState)(g||""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a&&(p&&p(),S(),R())},[a,f]),(0,c.useEffect)(()=>{a&&L&&T()},[L,i]);let R=async()=>{try{if("user"===h&&m.length>0){let a=[];for(let b of m)try{let c=await u(i,b.id);a=[...a,...c]}catch(a){}I(a)}}catch(a){console.error("Error fetching all user roles:",a)}},S=async()=>{D(!0);try{let a=await t(f);G(a.roles)}catch(a){console.error("Error fetching roles:",a),o.toast.error(a.message||"Failed to load roles")}finally{D(!1)}},T=async()=>{if(L)try{if("user"===h){let a=await u(i,L);I(a)}else{let a=await v(i,L);I(a)}}catch(a){console.error("Error fetching current roles:",a),o.toast.error(a.message||"Failed to load current roles")}},U=async()=>{let a=F.find(a=>a.id===N),b=a?.role_type==="administrator";if(N&&(b||J))try{let a=J,c=new Set(H.map(a=>a.project_id));if(b&&!a&&m.length>0){let b=m.find(a=>!c.has(a.id));b?a=b.id:(a=m[0].id,o.toast.warning("User already has roles in all projects. Attempting to assign as admin role (may need to remove existing role first)."))}if(!b&&J&&c.has(J)){let b=m.find(a=>!c.has(a.id));if(!b)return void o.toast.error("User already has a role on all projects. Please remove an existing role first, or assign an admin role for organization-wide access.");a=b.id,o.toast.info(`User already has a role on "${m.find(a=>a.id===J)?.name||"selected project"}". Assigning to "${b.name}" instead.`)}if(!a)return void o.toast.error("Please create a project first before assigning roles");"user"===h?await w(i,N,a):await x(i,N,a),o.toast.success("Role assigned successfully"),b&&o.toast.success("‚úÖ Admin user now has automatic access to all projects in this organization"),O(""),K(""),Q(!1),L===a&&await T(),n&&await n()}catch(a){o.toast.error(a.response?.data?.detail||a.message||"Failed to assign role")}},V=async a=>{if(confirm("Are you sure you want to remove this role assignment?"))try{"user"===h?await y(a):await z(a),o.toast.success("Role removed successfully"),await R(),L&&await T()}catch(a){o.toast.error(a.message||"Failed to remove role")}},W=a=>{switch(a){case"administrator":return"bg-red-100 text-red-800 border-red-200";case"project_manager":return"bg-purple-100 text-purple-800 border-purple-200";case"developer":return"bg-blue-100 text-blue-800 border-blue-200";case"tester":return"bg-green-100 text-green-800 border-green-200";case"viewer":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-cyan-100 text-cyan-800 border-cyan-200"}};return a?(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(l.Shield,{className:"w-6 h-6 text-primary"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Manage Roles - ",j]}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Assign and manage roles for this ",h]})]})]}),(0,b.jsx)("button",{onClick:e,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,b.jsx)(E.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:C?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)("div",{className:"text-gray-500",children:"Loading roles..."})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Assign Role"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Role"}),(0,b.jsxs)("select",{value:N,onChange:a=>O(a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,b.jsx)("option",{value:"",children:"Choose a role..."}),F.map(a=>(0,b.jsx)("option",{value:a.id,children:function(a){let b,c=q[a.toLowerCase()];return c?`${c.displayName} (${c.type})`:(b=q[a.toLowerCase()])?b.displayName:a.replace(/_/g," ").split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}(a.role_type)},a.id))]})]}),N&&(()=>{let a=F.find(a=>a.id===N);if(a?.role_type==="administrator")return(0,b.jsx)("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(l.Shield,{className:"w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-green-800 dark:text-green-200 mb-1",children:"Admin Role - No Project Selection Needed"}),(0,b.jsx)("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Admin users automatically have full access to all projects in this organization."})]})]})});let c=new Set(H.map(a=>a.project_id));return(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Project to Assign To"}),m.length>0?(0,b.jsxs)("select",{value:J,onChange:a=>K(a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,b.jsx)("option",{value:"",children:"Select a project..."}),m.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name,c.has(a.id)?" (already assigned)":""]},a.id))]}):(0,b.jsx)("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,b.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"‚ö†Ô∏è No projects available. Please create a project first before assigning roles."})})]}),c.size>0&&(0,b.jsxs)("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-amber-800 dark:text-amber-200 mb-2",children:"‚ÑπÔ∏è User already has roles on:"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:m.filter(a=>c.has(a.id)).map(a=>(0,b.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-amber-200 text-amber-900 dark:bg-amber-800 dark:text-amber-100 rounded",children:a.name},a.id))}),(0,b.jsx)("p",{className:"text-xs text-amber-700 dark:text-amber-300 mt-2",children:"System will automatically use a different project if you select one with an existing role."})]})]})})(),N&&(0,b.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(r=F.find(a=>a.id===N))?(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(l.Shield,{className:"w-5 h-5 text-blue-600"}),(0,b.jsx)("span",{className:"font-semibold text-blue-900 dark:text-blue-100",children:r.name}),(0,b.jsx)("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full border ${W(r.role_type)}`,children:r.role_type.replace("_"," ")})]}),r.description&&(0,b.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-200",children:r.description})]}):null}),(s=F.find(a=>a.id===N),A=s?.role_type==="administrator",B=N&&(A||J),(0,b.jsx)(d.Button,{onClick:U,disabled:!B,className:"w-full",children:"Assign Role"}))]})]}),(0,b.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Current Roles"}),H.length>0?(0,b.jsx)("div",{className:"space-y-3 mb-4",children:H.map(a=>{let c=a.role?.name||a.role_name||"Unknown Role",d=a.role?.role_type||a.role_type||"system",e=a.project_id,f=m.find(a=>a.id===e)?.name||"Unknown Project";return(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:c}),(0,b.jsx)("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full border ${W(d)}`,children:d.replace("_"," ")})]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Project: ",f]})]}),(0,b.jsx)("button",{onClick:()=>V(a.id),className:"ml-4 p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Remove role",children:(0,b.jsx)(k.Trash2,{size:16})})]},a.id)})}):(0,b.jsxs)("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600",children:[(0,b.jsx)(l.Shield,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"No roles assigned yet"})]}),m.length>0&&(0,b.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"View roles by project (optional)"}),(0,b.jsxs)("select",{value:L,onChange:a=>{M(a.target.value),a.target.value&&T()},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,b.jsx)("option",{value:"",children:"All projects"}),m.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),L&&0===H.length?(0,b.jsxs)("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600",children:[(0,b.jsx)(l.Shield,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),(0,b.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No roles assigned yet for this project"})]}):(0,b.jsx)("div",{className:"space-y-3",children:H.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(l.Shield,{className:"w-5 h-5 text-gray-400"}),(0,b.jsx)("div",{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:a.role?.name||a.role_name}),(0,b.jsx)("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full border ${W(a.role?.role_type||a.role_type)}`,children:(a.role?.role_type||a.role_type).replace("_"," ")})]})})]}),(0,b.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:()=>V(a.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:(0,b.jsx)(k.Trash2,{className:"w-4 h-4"})})]},a.id))})]})]})}),(0,b.jsx)("div",{className:"flex items-center justify-end gap-2 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:(0,b.jsx)(d.Button,{variant:"outline",onClick:e,children:"Close"})})]})}):null}var G=a.i(75353),H=a.i(96221);let I={"User Management":["user_read_access","user_write_access","user_delete_access"],"Role Management":["role_read_access","role_write_access","role_delete_access"],"Project Management":["project_read_access","project_write_access","project_delete_access"],Settings:["settings_read_access","settings_write_access"],Organization:["organization_manage_access"],"Test Case Management":["test_case_read_access","test_case_write_access","test_case_delete_access","test_case_execute_access"],"Security Testing":["security_test_read_access","security_test_write_access","security_test_delete_access","security_test_execute_access"],"API Testing":["api_test_read_access","api_test_write_access","api_test_delete_access","api_test_execute_access"],"Automation Hub":["automation_read_access","automation_write_access","automation_delete_access","automation_execute_access"]};function J({organisationId:a,isAdmin:d=!1}){let[e,f]=(0,c.useState)([]),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!0),[k,l]=(0,c.useState)({}),[m,n]=(0,c.useState)(I);(0,c.useEffect)(()=>{o()},[a]);let o=async()=>{j(!0);try{let b=(await s.default.get("/api/v1/roles/",{params:{organisation_id:a}})).data.roles||[];console.log("üéØ Roles from API:",b.map(a=>({id:a.id,name:a.name,role_type:a.role_type,permissions_from_api:a.permissions?.length||0,permission_count:a.permission_count}))),f(b);let c=[];try{let{permission_groups:b,all_permissions:d,enabled_modules:e}=(await s.default.get(`/api/v1/roles/dynamic/${a}`)).data;b&&n(b),e&&setEnabledModules(e),c=d||[],h(c)}catch(a){console.warn("Could not fetch dynamic permissions, using static permissions:",a),c=(await s.default.get("/api/v1/roles/permissions")).data.permissions||[],h(c)}let d={},e={};c.forEach(a=>{e[a.name]=a.id}),console.log("üîç Permission name to ID mapping:",Object.keys(e).slice(0,5)),console.log("üìã Total permissions found:",c.length),b.forEach(a=>{let b=[];console.log(`üîç Processing role "${a.name}" (${a.role_type}):`,{hasPermissions:!!a.permissions,permissionCount:a.permissions?.length||0,permissionIds:a.permissions?.map(a=>a.id)||[]}),a.permissions&&a.permissions.length>0?(b=a.permissions.map(a=>a.id),console.log(`‚úÖ Role "${a.name}" (${a.role_type}): ${b.length} permissions from API`),console.log(`   Permission IDs: ${b.slice(0,3).join(", ")}...`)):console.log(`‚ö†Ô∏è Role "${a.name}" (${a.role_type}) has NO permissions assigned in database`),d[a.id]=b}),console.log("üìù Detailed permission mapping:"),Object.entries(d).forEach(([a,d])=>{let e=b.find(b=>b.id===a);console.log(`  ${e?.name}: [${d.map(a=>{let b=c.find(b=>b.id===a);return b?.name||a}).join(", ")}]`)}),console.log("üìä Final permission map:",Object.entries(d).map(([a,b])=>({roleId:a.slice(0,8),count:b.length,sampleIds:b.slice(0,2)}))),l(d),setOriginalRolePermissions(JSON.parse(JSON.stringify(d)))}catch(a){console.error("Failed to fetch data:",a),toast.error("Failed to load roles and permissions")}finally{j(!1)}};return i?(0,b.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,b.jsx)(H.Loader2,{className:"w-6 h-6 animate-spin text-primary"}),(0,b.jsx)("span",{className:"ml-2",children:"Loading permission matrix..."})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Role Permissions Matrix"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"View current role permissions (read-only)"})]}),(0,b.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-800",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm border-collapse",style:{tableLayout:"fixed"},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("th",{className:"px-3 py-3 text-left font-semibold text-gray-900 dark:text-white sticky left-0 bg-gray-50 dark:bg-gray-900 z-10",style:{width:"192px"},children:"Permission"}),e.map(a=>(0,b.jsx)("th",{className:"px-2 py-3 text-center font-semibold text-gray-900 dark:text-white whitespace-nowrap align-middle",style:{width:"120px"},children:(0,b.jsx)("div",{className:"truncate text-xs",title:a.name,children:a.name})},a.id))]})}),(0,b.jsx)("tbody",{children:Object.entries(m).map(([a,d])=>(0,b.jsxs)(c.Fragment,{children:[(0,b.jsx)("tr",{className:"bg-blue-50 dark:bg-blue-900/20 border-b border-gray-200 dark:border-gray-700",children:(0,b.jsx)("td",{colSpan:e.length+1,className:"px-3 py-2 text-sm font-bold text-blue-900 dark:text-blue-200 sticky left-0 bg-blue-50 dark:bg-blue-900/20 z-10",children:a})}),d.map((c,d)=>{let f=g.find(a=>a.name===c);return f?(0,b.jsxs)("tr",{className:"border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,b.jsx)("td",{className:"px-3 py-3 text-gray-900 dark:text-white sticky left-0 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/50 z-10 align-middle",style:{width:"192px"},children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-xs truncate",title:f.name,children:f.name}),(0,b.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 hidden sm:block truncate",title:f.description||`${f.action} ${f.resource}`,children:f.description||`${f.action} ${f.resource}`})]})}),e.map(a=>{let c=(k[a.id]||[]).includes(f.id);return(0,b.jsx)("td",{className:"px-2 py-3 text-center align-middle",style:{width:"120px"},children:(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)("input",{type:"checkbox",checked:!0===c,onChange:()=>{},className:"w-4 h-4 accent-primary",disabled:!0,title:"Permission matrix is read-only","data-role":a.id,"data-perm":f.id})})},`${a.id}-${f.id}`)})]},`${a}-${c}-${d}`):null})]},a))})]})})}),(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:e.map(a=>(0,b.jsxs)("div",{className:"p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-gray-900 dark:text-white mb-1 truncate",title:a.name,children:a.name}),(0,b.jsx)("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:(k[a.id]||[]).length}),(0,b.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"assigned"})]},a.id))})]})}var K=a.i(44726);function L(){let a,e,u=(0,n.useParams)().uuid,{user:v}=(0,K.useAuth)(),[w,x]=(0,c.useState)("users"),[y,z]=(0,c.useState)(null),[E,H]=(0,c.useState)([]),[I,L]=(0,c.useState)([]),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)(!0),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)([]),[W,X]=(0,c.useState)({}),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(!1),[aa,ab]=(0,c.useState)(!1),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)("list"),[ai,aj]=(0,c.useState)(!1),[ak,al]=(0,c.useState)(null),[am,an]=(0,c.useState)(null),[ao,ap]=(0,c.useState)(null),[aq,ar]=(0,c.useState)(null),[as,at]=(0,c.useState)(null),[au,av]=(0,c.useState)(""),[aw,ax]=(0,c.useState)(!1),[ay,az]=(0,c.useState)({email:"",username:"",password:"",full_name:""}),[aA,aB]=(0,c.useState)({name:"",roleType:"",description:"",selectedPermissions:[]});(0,c.useEffect)(()=>{(async()=>{try{let a=(await s.default.get("/api/v1/projects/",{params:{organisation_id:u}})).data;V(a),await Promise.all([aD(a),aH()])}catch(a){console.error("Error loading data:",a),o.toast.error("Failed to load data")}})()},[u,w]);let aC=async()=>{await aD(U)},aD=async a=>{R(!0);try{let b=await s.default.get(`/api/v1/organisations/${u}`);z(b.data);let c=v?.is_superuser||v?.id===b.data.owner_id;Z(c);let d=await D(u);H(d);let e=await t(u);L(e.roles),await aE(d,a),d.length>0&&aF(d,a)}catch(a){console.error("Error fetching data:",a),o.toast.error(a.message||"Failed to load data")}finally{R(!1)}},aE=async(a,b=U)=>{try{let a=[];for(let c of b)try{let b=await s.default.get("/api/v1/roles/assignments/users",{params:{project_id:c.id}});b.data.assignments&&(a=[...a,...b.data.assignments])}catch(a){}P(a)}catch(a){console.error("Error fetching user roles:",a)}},aF=async(a,b=U)=>{try{let c={};for(let d of a){let a=[];for(let c of b)try{(await s.default.get(`/api/v1/projects/${c.id}/members`)).data.some(a=>a.id===d.id)&&a.push(c)}catch(a){}c[d.id]=a}X(c)}catch(a){console.error("Error fetching user projects:",a)}},aG=async a=>{try{let b=[];for(let c of U)try{(await s.default.get(`/api/v1/projects/${c.id}/members`)).data.some(b=>b.id===a)&&b.push(c)}catch(a){}X(c=>({...c,[a]:b}))}catch(a){console.error("Failed to fetch user projects:",a)}},aH=async()=>{try{let a=await C();N(a)}catch(a){console.error("Error fetching permissions:",a)}},aI=async()=>{if(!ay.email)return void o.toast.error("Email address is required");try{await (0,G.createInvitation)({email:ay.email,full_name:ay.full_name||void 0,organisation_id:u,expiry_days:7}),o.toast.success(`Invitation sent to ${ay.email}`),_(!1),az({email:"",username:"",password:"",full_name:""}),aC()}catch(a){console.error("Failed to send invitation:",a),o.toast.error(a.response?.data?.detail||"Failed to send invitation")}},aJ=async a=>{if(aq)try{await s.default.post(`/api/v1/projects/${a}/members`,null,{params:{user_id:aq.id}}),o.toast.success(`${aq.username} assigned to project`),await aG(aq.id)}catch(a){console.error("Failed to assign user:",a),o.toast.error(a.response?.data?.detail||"Failed to assign user")}},aK=async a=>{if(aq&&confirm(`Remove ${aq.username} from this project?`))try{await s.default.delete(`/api/v1/projects/${a}/members/${aq.id}`),o.toast.success("User removed from project"),await aG(aq.id)}catch(a){console.error("Failed to remove user:",a),o.toast.error(a.response?.data?.detail||"Failed to remove user")}},aL=async()=>{if(!aA.name||!aA.roleType)return void o.toast.error("Please fill in all required fields");try{await A(u,aA.name,aA.roleType,aA.description,aA.selectedPermissions),o.toast.success("Role created successfully"),af(!1),aB({name:"",roleType:"",description:"",selectedPermissions:[]}),aC()}catch(a){console.error("Failed to create role:",a),o.toast.error(a.response?.data?.detail||"Failed to create role")}},aM=async a=>{a.is_system_role?o.toast.error("Cannot delete system roles"):(al(a),aj(!0))},aN=async()=>{if(ak){an(ak.id);try{await B(ak.id),o.toast.success(`Role "${ak.name}" deleted successfully`),aj(!1),al(null),aC()}catch(a){console.error("Failed to delete role:",a),o.toast.error(a.response?.data?.detail||"Failed to delete role")}finally{an(null)}}},aO=E.filter(a=>a.email.toLowerCase().includes(S.toLowerCase())||a.username.toLowerCase().includes(S.toLowerCase())||a.full_name&&a.full_name.toLowerCase().includes(S.toLowerCase())),aP=I.filter(a=>a.name.toLowerCase().includes(S.toLowerCase())||a.role_type.toLowerCase().includes(S.toLowerCase())||a.description&&a.description.toLowerCase().includes(S.toLowerCase())).sort((a,b)=>a.name.localeCompare(b.name));return Q?(0,b.jsxs)("div",{className:"flex min-h-screen",children:[(0,b.jsx)(r.Sidebar,{organisationId:u}),(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center bg-white",children:(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("div",{className:"text-gray-500",children:"Loading..."})})})]}):(0,b.jsxs)("div",{className:"flex min-h-screen bg-white",children:[(0,b.jsx)(r.Sidebar,{organisationId:u}),(0,b.jsxs)("div",{className:"flex-1 p-8",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-primary rounded-2xl flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(h.Users,{className:"w-8 h-8 text-white"})}),(0,b.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Users & Teams"})]}),(0,b.jsx)("p",{className:"text-lg text-gray-600 mb-8 mt-4",children:"Manage user access, teams, and role assignments"}),(0,b.jsx)("div",{className:"flex items-center justify-end mb-8",children:(0,b.jsxs)("div",{className:"flex gap-2",children:["users"===w&&(0,b.jsxs)(d.Button,{onClick:()=>_(!0),children:[(0,b.jsx)(f,{className:"mr-2 h-4 w-4"}),"Invite User"]}),"roles"===w&&(0,b.jsxs)(d.Button,{onClick:()=>af(!0),children:[(0,b.jsx)(l.Shield,{className:"mr-2 h-4 w-4"}),"Create Role"]})]})}),(0,b.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,b.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,b.jsxs)("button",{onClick:()=>x("users"),className:`${"users"===w?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2`,children:[(0,b.jsx)(g.User,{className:"w-4 h-4"}),"Users (",E.length,")"]}),(0,b.jsxs)("button",{onClick:()=>x("roles"),className:`${"roles"===w?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2`,children:[(0,b.jsx)(l.Shield,{className:"w-4 h-4"}),"Roles (",I.length,")"]})]})}),(0,b.jsx)("div",{className:"mb-6 flex gap-3",children:(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(i.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,b.jsx)("input",{type:"text",placeholder:`Search ${w}...`,value:S,onChange:a=>T(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]})}),"users"===w&&(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[(0,b.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"User"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Role"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Projects"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Created"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3 text-center",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:0===aO.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500",children:"No users found. Invite users to get started."})}):aO.map(a=>(0,b.jsxs)("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"h-10 w-10 flex-shrink-0",children:(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-teal-500 to-cyan-600 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-sm font-semibold text-white",children:a.username.substring(0,2).toUpperCase()})})}),(0,b.jsxs)("div",{className:"ml-4",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.full_name||a.username}),(0,b.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.email})]})]})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(()=>{let c=O.filter(b=>b.user_id===a.id);if(0===c.length)return(0,b.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No roles"});let d=Array.from(new Map(c.map(a=>[a.role?.name||a.role_name||"Unknown Role",a])).values());return(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:d.map(a=>(0,b.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:a.role?.name||a.role_name||"Unknown Role"},a.id))})})()}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsxs)("div",{className:"space-y-1",children:[O.some(b=>b.user_id===a.id&&(b.role?.name==="Admin"||"Admin"===b.role_name))?(0,b.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[(0,b.jsx)(l.Shield,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,b.jsx)("span",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"All projects (auto)"})]}):(W[a.id]||[]).length>0?(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:(W[a.id]||[]).map(a=>(0,b.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:a.name},a.id))}):(0,b.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No projects"}),(0,b.jsxs)("button",{onClick:()=>{ar(a),ab(!0)},className:"text-xs text-primary hover:underline flex items-center gap-1 mt-1",children:[(0,b.jsx)(m.Plus,{className:"w-3 h-3"}),"Manage Projects"]})]})}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:(0,p.formatDateHumanReadable)(a.created_at)}),(0,b.jsx)("td",{className:"px-6 py-4 flex justify-center items-center",children:(0,b.jsxs)("button",{onClick:()=>{at({type:"user",id:a.id,name:a.full_name||a.username}),ad(!0)},className:"flex items-center gap-1 px-3 py-2 rounded-lg text-blue-600 bg-blue-50 hover:bg-blue-100 dark:text-blue-400 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 transition-colors",children:[(0,b.jsx)(j,{className:"w-4 h-4"}),"Edit Roles"]})})]},a.id))})]})})}),"roles"===w&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-6 flex gap-4 border-b border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("button",{onClick:()=>ah("list"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors ${"list"===ag?"border-primary text-primary":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:"üìã Roles List"}),(0,b.jsx)("button",{onClick:()=>ah("matrix"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors ${"matrix"===ag?"border-primary text-primary":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:"üîê Permission Matrix"})]}),"list"===ag&&(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[(0,b.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Role Name"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Type"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Description"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Status"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"System Role"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Created"}),(0,b.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:0===aP.length?(0,b.jsx)("tr",{children:(0,b.jsxs)("td",{colSpan:7,className:"px-6 py-8 text-center text-gray-500",children:["No roles found. ",0===I.length?"Initialize default roles or create a custom role to get started.":"Try adjusting your search."]})}):aP.map(a=>{let c;return(0,b.jsxs)("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:a.name})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:(c=q[a.role_type.toLowerCase()])?c.type:"Unknown"})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate",children:a.description||"-"})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.is_active?"Active":"Inactive"})}),(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a.is_system_role?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:a.is_system_role?"System":"Custom"})}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:(0,p.formatDateHumanReadable)(a.created_at)}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsxs)("button",{onClick:()=>aM(a),disabled:a.is_system_role||am===a.id,className:"inline-flex items-center gap-2 text-red-600 hover:text-red-800 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors",title:a.is_system_role?"Cannot delete system roles":"Delete role",children:[(0,b.jsx)(k.Trash2,{size:16}),am===a.id?"Deleting...":"Delete"]})})]},a.id)})})]})})}),"matrix"===ag&&(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-8",children:(0,b.jsx)(J,{organisationId:u,isAdmin:Y})})]}),$&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-4",children:"üìß Invite User"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"Send an invitation email. The user will receive a welcome email with a link to create their account and join your organization."}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Email Address ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"email",value:ay.email,onChange:a=>az({...ay,email:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"user@example.com"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Full Name (Optional)"}),(0,b.jsx)("input",{type:"text",value:ay.full_name,onChange:a=>az({...ay,full_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"John Doe"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"This will be pre-filled in the invitation email"})]}),(0,b.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:(0,b.jsxs)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["üí° The invitation will expire in ",(0,b.jsx)("strong",{children:"7 days"}),". The user will choose their username and password when they accept the invitation."]})})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>{_(!1),az({email:"",username:"",password:"",full_name:""})},children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:aI,disabled:!ay.email,children:"Send Invitation"})]})]})}),ae&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Create Custom Role"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"Create a custom role with specific permissions for your organization."}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Role Name ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"text",value:aA.name,onChange:a=>aB({...aA,name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"e.g., QA Lead"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Role Type ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"text",value:aA.roleType,onChange:a=>aB({...aA,roleType:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"e.g., qa_lead (lowercase, underscores)"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Use lowercase letters and underscores only (e.g., qa_lead, senior_qa_engineer)"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),(0,b.jsx)("textarea",{value:aA.description,onChange:a=>aB({...aA,description:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:3,placeholder:"Describe the responsibilities and access level of this role..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Permissions (Optional)"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"Select permissions by module. Each module has READ, WRITE, EXECUTE, and MANAGE permission levels."}),(0,b.jsx)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-md p-4 max-h-96 overflow-y-auto",children:0===M.length?(0,b.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No permissions available. Run the module permissions initialization script first."}):(0,b.jsx)("div",{className:"space-y-4",children:(a=M.reduce((a,b)=>{let c=b.resource;return a[c]||(a[c]=[]),a[c].push(b),a},{}),e={automation_hub:{name:"Automation Hub",icon:"ü§ñ",color:"blue"},api_testing:{name:"API Testing",icon:"üîå",color:"green"},test_management:{name:"Test Management",icon:"üìã",color:"purple"},security_testing:{name:"Security Testing",icon:"üîí",color:"red"},performance_testing:{name:"Performance Testing",icon:"‚ö°",color:"yellow"},mobile_testing:{name:"Mobile Testing",icon:"üì±",color:"indigo"}},Object.keys(a).sort((a,b)=>{let c=["automation_hub","api_testing","test_management","security_testing","performance_testing","mobile_testing"];return c.indexOf(a)-c.indexOf(b)}).map(c=>{let d=e[c]||{name:c,icon:"üì¶",color:"gray"},f=a[c].sort((a,b)=>{let c=["read","write","execute","manage"];return c.indexOf(a.action)-c.indexOf(b.action)});return(0,b.jsxs)("div",{className:`border rounded-lg p-3 ${{blue:"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800",green:"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800",purple:"bg-purple-50 border-purple-200 dark:bg-purple-900/20 dark:border-purple-800",red:"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800",yellow:"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800",indigo:"bg-indigo-50 border-indigo-200 dark:bg-indigo-900/20 dark:border-indigo-800",gray:"bg-gray-50 border-gray-200 dark:bg-gray-900/20 dark:border-gray-800"}[d.color]}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)("span",{className:"text-xl",children:d.icon}),(0,b.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:d.name}),(0,b.jsxs)("span",{className:"ml-auto text-xs text-gray-500 dark:text-gray-400",children:[f.filter(a=>aA.selectedPermissions.includes(a.id)).length,"/",f.length," selected"]})]}),(0,b.jsx)("div",{className:"space-y-2",children:f.map(a=>(0,b.jsxs)("label",{className:"flex items-start gap-2 p-2 hover:bg-white/50 dark:hover:bg-gray-800/50 rounded cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:aA.selectedPermissions.includes(a.id),onChange:b=>{b.target.checked?aB({...aA,selectedPermissions:[...aA.selectedPermissions,a.id]}):aB({...aA,selectedPermissions:aA.selectedPermissions.filter(b=>b!==a.id)})},className:"mt-1 h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[(0,b.jsx)("span",{className:"uppercase text-xs px-2 py-0.5 bg-white dark:bg-gray-700 rounded font-semibold",children:a.action}),(0,b.jsx)("span",{className:"truncate text-xs",children:a.name})]}),a.description&&(0,b.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:a.description})]})]},a.id))})]},c)}))})}),aA.selectedPermissions.length>0&&(0,b.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["‚úÖ ",aA.selectedPermissions.length," permission(s) selected across ",new Set(M.filter(a=>aA.selectedPermissions.includes(a.id)).map(a=>a.resource)).size," module(s)"]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>{af(!1),aB({name:"",roleType:"",description:"",selectedPermissions:[]})},children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:aL,disabled:!aA.name||!aA.roleType,children:"Create Role"})]})]})}),aa&&aq&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Manage Projects for ",aq.full_name||aq.username]}),(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Assign or remove this user from projects in your organization"})]})}),(0,b.jsx)("div",{className:"space-y-3",children:0===U.length?(0,b.jsx)("div",{className:"text-center py-12 text-gray-500",children:"No projects available. Create a project first."}):U.map(a=>{let c=(W[aq.id]||[]).some(b=>b.id===a.id);return(0,b.jsxs)("div",{className:`flex items-center justify-between p-4 border rounded-lg transition-colors ${c?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50"}`,children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),c&&(0,b.jsx)("span",{className:"px-2 py-0.5 text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200 rounded-full",children:"Assigned"})]}),a.description&&(0,b.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.description})]}),(0,b.jsx)("div",{className:"ml-4",children:c?(0,b.jsx)("button",{onClick:()=>aK(a.id),className:"px-4 py-2 text-sm bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/30 transition-colors font-medium",children:"Remove"}):(0,b.jsx)("button",{onClick:()=>aJ(a.id),className:"px-4 py-2 text-sm bg-primary text-white rounded-lg hover:opacity-90 transition-opacity font-medium",children:"Assign"})})]},a.id)})}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(W[aq.id]||[]).length," of ",U.length," projects assigned"]}),(0,b.jsx)("button",{onClick:()=>{ab(!1),ar(null)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Close"})]})]})}),ac&&as&&(0,b.jsx)(F,{isOpen:ac,onClose:()=>{ad(!1),at(null),aC()},organisationId:u,entityType:as.type,entityId:as.id,entityName:as.name,availableProjects:U,onRoleAssigned:aC,onModalOpen:async()=>{try{let a=await s.default.get("/api/v1/projects/",{params:{organisation_id:u}});V(a.data)}catch(a){console.error("Error refreshing projects:",a)}}}),ai&&ak&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/20",children:(0,b.jsx)(k.Trash2,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),(0,b.jsx)("div",{children:(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Delete Role"})})]}),(0,b.jsxs)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete the role ",(0,b.jsx)("strong",{children:ak.name}),"? This action cannot be undone."]}),(0,b.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,b.jsx)("button",{onClick:()=>{aj(!1),al(null)},disabled:null!==am,className:"px-4 py-2 text-sm font-medium border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Cancel"}),(0,b.jsx)("button",{onClick:aN,disabled:null!==am,className:"px-4 py-2 text-sm font-medium bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:am===ak.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"animate-spin",children:"‚è≥"}),"Deleting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Trash2,{size:16}),"Delete Role"]})})]})]})})]})]})}a.s(["default",()=>L],81763)}];

//# sourceMappingURL=frontend_app_organizations_%5Buuid%5D_users-teams_page_tsx_4da53e8a._.js.map